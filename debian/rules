#!/usr/bin/make -f
# See debhelper(7) (uncomment to enable)
# output every command that modifies files on the build system.
export DH_VERBOSE = 1

#include /usr/share/dpatch/dpatch.make

DEB_HOST_GNU_TYPE ?=$(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
DEB_BUILD_GNU_TYPE ?=$(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)

ifneq ($(DEB_HOST_GNU_TYPE),$(DEB_BUILD_GNU_TYPE))
confflags= --build $(DEB_BUILD_GNU_TYPE) --host $(DEB_HOST_GNU_TYPE)
else
confflags= --build $(DEB_BUILD_GNU_TYPE)
endif

clean:
	dh_testdir
	dh_testroot
	dh_clean

build: install

install:
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs 
	npm install 
	cp -pdRx `ls -A | grep -vE "debian|.git"` debian/fleximanage/opt/fleximanage
	install -m 0644 -o root -g root debian/fleximanage.service debian/fleximanage/lib/systemd/system/fleximanage.service

# Build architecture-independent files here.
binary-indep: install
	dh_testdir
	dh_testroot
	dh_installchangelogs
	dh_compress
	dh_fixperms
	dh_installdebconf
	dh_installdeb
#	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep
.PHONY: clean build binary-indep binary install
